---
lab:
    title: 'Azure Databricks を使用した分散ディープ ラーニング'
    module: 'オプションの演習'
---

# 分散ディープ ラーニングの設定

まず、対話型**標準**クラスターを使用して Azure Databricks ワークスペースにアクセスできる必要があります。ワークスペースや必要なクラスターがない場合は、次の手順を実行します。

## Azure Databricks リソースを作成する

Azure Databricks を使用するには、最初に Azure サブスクリプションに Azure Databricks ワークスペースをデプロイし、ノートブックとコードを実行するクラスターを作成する必要があります。次に、データとノートブックをアップロードして、ワークスペースで実験することができます。

### Azure Databricks ワークスペースをデプロイする

1. [Azure portal](https://portal.azure.com) で、次の設定を指定して新しい **Azure Databricks** リソースを作成します。
   - **サブスクリプション**: *ワークスペースをデプロイする Azure サブスクリプションを選択します。*
   - **リソース グループ**: *新しいリソース グループを作成します。*
   - **ワークスペース名**: *ワークスペースの名前を指定します。*
   - **リージョン**: *デプロイ用としてお近くの場所を選択します。Azure Databricks でサポートされているリージョンのリストについては、[リージョン別の利用可能な Azure サービス](https://azure.microsoft.com/regions/services/)を参照してください。*
   - **価格レベル**: 標準

1. ワークスペースが作成されるまで待ちます。ワークスペース の作成には数分かかります。ワークスペースの作成時に、ポータルの右側に「Azure Databricks のデプロイを送信しています」タイルが表示されます。このタイルを表示するために、ダッシュボードを右へスクロールしなければならない場合があります。スクリーンの上部に進行状況バーも表示されます。いずれかの領域で進行状況を確認できます。

### クラスターを作成する

1. Azure Databricks ワークスペース リソースが作成されたら、ポータルでそのリソースに移動し、「**ワークスペースの起動**」を選択して新しいタブで Databricks ワークスペースを開き、プロンプトが表示されたらサインインします。

1. Databricks ワークスペースの左側のメニューで、「**コンピューティング**」を選択し、「**+ クラスターの作成**」を選択して、次の構成で新しいクラスターを追加します。
   - **名前**: *一意の名前を入力します。*
   - **クラスター モード**: 標準
   - **プール**: 必要ない
   - **Databricks ランタイムのバージョン**: *ランタイムの利用可能な最新バージョンの **ML** エディションを選択します。選択したバージョンが以下であること確認してください。*
      - *この演習では、CPU クラスターと GPU クラスターの両方を使用できます。CPU は GPU よりもテストに安価です。*
      - *Scala > **2.11** を含みます*
      - *Spark > **3.0** を含みます*
   - **終了までの時間**: 120 分間の非アクティブ
   - **ノードの種類**: Standard_DS3_v2

1. クラスターが作成されるまで待ちます。これには数分かかる場合があります。クラスターは自動的に開始され、最終的にクラスター名の横にある回転する*保留中*のインジケーターが緑色の丸に変わり、*実行中*のステータスを示します。

### Databricks ノートブックをインポートする

1. Azure Databricks ワークスペースで、左側のコマンド バーを使用して、「**ワークスペース**」を選択します。次に、「**ユーザー**」を選択し、**&#9751; *your_user_name*** を選択します。

1. ブレードが表示されるので、名前の横にある下向きのシェブロン (**v**) を選択し、「**インポート**」を選択します。

1. 「**ノートブックのインポート**」ダイアログで、次の URL からノートブック アーカイブをインポートします。アーカイブ名のフォルダーが作成され、2 つのノートブックが含まれていることに注意してください。
   - `https://github.com/MicrosoftLearning/dp-090-databricks-ml/blob/madiepev-add-modules/06%20-%20Distributed%20Deep%20Learning.dbc`

## 分散ディープ ラーニングを調べる

この演習では、ハイパーパラメーターのチューニングに自動化された MLflow を使用する方法を学びます。

1. ワークスペースの **05 - ハイパーパラメーターのチューニング**のフォルダ－で、**1.0 自動化された MLflow ハイパーパラメーターのチューニング**のノートブックを開きます。

1. 左上のドロップダウン メニューで、クラスターを選択して、ノートブックをそのクラスターに接続します。*(または、接続されていないノートブックで最初のセルを実行するときに、クラスターを接続するように求められます)。*

1. ノートブック内の注意事項を読み、各コード セルを順番に実行します。

## クリーンアップ

今のところ Azure Databricks の操作が終了している場合は、Azure Databricks ワークスペースの「**コンピューティング**」ページで、クラスターを選択し、「**&#9632;終了**」を選択して、シャットダウンします。それ以外の場合は、次の演習のために実行したままにします。
